(()=>{let e={type:Phaser.AUTO,width:800,height:600,physics:{default:"arcade",arcade:{gravity:{y:0},debug:!1}},scene:{preload:function(){this.load.setBaseURL(""),this.load.image("background","/assets/img/background.png"),this.load.image("player","/assets/img/robot.png"),this.load.image("treasure","/assets/img/treasure-mound.png"),this.load.image("amogus","/assets/img/sus.png")},create:function(){const e=this;this.socket=io(),this.otherPlayers=this.physics.add.group(),this.socket.on("currentPlayers",(t=>{Object.keys(t).forEach((s=>{t[s].playerId===e.socket.id?function(e,t){e.player=e.physics.add.sprite(t.x,t.y,"player"),e.player.setBounce(0),e.player.setCollideWorldBounds(!0),e.cameras.main.startFollow(e.player)}(e,t[s]):b(e,t[s])}))})),this.socket.on("newPlayer",(t=>{b(e,t)})),this.socket.on("playerDisconnected",(t=>{e.otherPlayers.getChildren().forEach((e=>{t===e.playerId&&e.destroy()}))})),a=this.input.keyboard.createCursorKeys(),this.socket.on("playerMoved",(t=>{e.otherPlayers.getChildren().forEach((e=>{t.playerId===e.playerId&&e.setPosition(t.x,t.y)}))})),this.gameTimer=240,this.socket.on("timerTicked",(t=>{e.gameTimer=t,r.setText(K(e.gameTimer))})),this.treasures=this.physics.add.group(),this.socket.on("placeTreasures",(t=>{t.forEach((t=>{!function(e,t){const s=e.physics.add.sprite(t.x,t.y,"treasure");s._id=t._id,s.challenge=t.challenge,e.treasures.add(s)}(e,t)}))})),this.socket.on("treasureRemoved",(t=>{const s=e.treasures.getChildren().find((e=>e._id===t._id));h&&p===s&&(h=!1,l.setText("")),s.destroy()})),this.playerWinText=this.add.text(0,0,"",{fontSize:"32px",fill:"#000",align:"center"}),this.playerWinText.setDepth(1),this.gameOver=!1,this.socket.on("playerWon",(t=>{console.log(t);let s="";t.forEach((e=>{s+=`${e.playerId}: ${e.score}\n`})),e.playerWinText.setText(s),e.playerWinText.x=this.player.body.position.x,e.playerWinText.y=this.player.body.position.y-200,e.gameOver=!0})),this.add.image(500,500,"background"),this.cameras.main.setBackgroundColor("#863b00"),this.physics.world.setBounds(0,0,1e3,1e3),i=0,d=this.add.text(16,16,i,{fontSize:"32px",fill:"#000"}),d.setDepth(1),r=this.add.text(500,245,K(this.gameTimer),{fontSize:"32px",fill:"#000"}),r.setDepth(1),l=this.add.text(532,600,"",{fontSize:"40px",fill:"#000",align:"center"}),l.setDepth(1),o=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE),h=!1,y=[],y.push(this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.Q)),y.push(this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.W)),y.push(this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.E)),y.push(this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.R)),y.push(this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.T)),y.push(this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.Y)),y.push(this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.U)),y.push(this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.I)),y.push(this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.O)),y.push(this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.P)),y.push(this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.A)),y.push(this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.S)),y.push(this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.D)),y.push(this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.F)),y.push(this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.G)),y.push(this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.H)),y.push(this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.J)),y.push(this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.K)),y.push(this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.L)),y.push(this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.Z)),y.push(this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.X)),y.push(this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.C)),y.push(this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.V)),y.push(this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.B)),y.push(this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.N)),y.push(this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.M))},update:function(){var e;this.player&&!this.gameOver&&(a.left.isDown&&!h?this.player.setVelocityX(-300):a.right.isDown&&!h?this.player.setVelocityX(t):this.player.setVelocityX(0),a.up.isDown&&!h?this.player.setVelocityY(-300):a.down.isDown&&!h?this.player.setVelocityY(t):this.player.setVelocityY(0),Phaser.Input.Keyboard.JustDown(o)&&!h&&this.treasures.children.iterate((e=>{this.physics.world.overlap(this.player,e,u)})),h&&Phaser.Input.Keyboard.JustDown(y[p.challenge[n]])&&(n++,l.setText(l.text+" "+s[p.challenge[n]]),n>=p.challenge.length&&(this,e=p,i++,d.setText(i),h=!1,l.setText(""),this.socket.emit("treasureCollected",{x:e.x,y:e.y,challenge:e.challenge,_id:e._id}),e.destroy())),d.x=this.player.body.position.x-350,d.y=this.player.body.position.y-255,r.x=this.player.body.position.x,r.y=this.player.body.position.y-255,l.x=this.player.body.position.x+this.player.body.width/2-l.displayWidth/2,l.y=this.player.body.position.y+100,!this.player.oldPosition||this.player.body.position.x===this.player.oldPosition.x&&this.player.body.position.y===this.player.oldPosition.y||this.socket.emit("playerMovement",{x:this.player.body.position.x,y:this.player.body.position.y}),this.player.oldPosition={x:this.player.body.position.x,y:this.player.body.position.y})}}};const t=300,s=["Q","W","E","R","T","Y","U","I","O","P","A","S","D","F","G","H","J","K","L","Z","X","C","V","B","N","M"];let a,o,i,d,r,y,h,p,n,l;function u(e,t){p=t,h=!0,n=0,l.setText(s[p.challenge[n]])}function K(e){let t=Math.floor(e/60),s=Math.floor(e%60);return`${t}:${s<10?"0"+s:s}`}function b(e,t){const s=e.physics.add.sprite(t.x,t.y,"amogus").setOrigin(.25);s.playerId=t.playerId,s.setPosition(t.x,t.y),e.otherPlayers.add(s)}new Phaser.Game(e)})();